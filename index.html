<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Time Capsule</title>
    <!-- Favicon configuration -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
    <link rel="stylesheet" href="styles.css">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' chrome-extension:; style-src 'self' 'unsafe-inline'; connect-src *; img-src 'self' data:;">
</head>
<body>
    <div class="experimental-banner">
        üß™ EXPERIMENTAL PROJECT: This is a testnet demonstration and should not be used for important messages
    </div>

    <header>
        <div class="header-content">
            <h1>Bitcoin Time Capsule</h1>
            <div class="wallet-section">
                <button id="connectWallet">Connect Wallet (Unisat)</button>
                <p id="walletStatus">Wallet Status: Not Connected</p>
            </div>
        </div>
    </header>

    <main>
        <div class="grid-container">
            <!-- Left Column -->
            <div class="left-column">
                <div class="info-card">
                    <h2>üìå What is TimeCapsuleContract?</h2>
                    <p>
                        A blockchain-based message vault that lets users store encrypted messages on Bitcoin Signet.
                        Messages remain locked until a specific future block height is reached.
                        Once unlockable, the first three participants to retrieve messages receive portions of the fees.
                    </p>
                    
                    <div class="alert-box">
                        <h3>üö® Important: Signet BTC Only!</h3>
                        <p>
                            This contract operates on <strong>Bitcoin Signet (testnet)</strong>, not real BTC.
                            You can request free Signet BTC from the <a href="https://signetfaucet.com/" target="_blank">Bitcoin Signet Faucet</a>.
                        </p>
                    </div>
                    
                    <h3>üîπ Enable Signet in Your Wallet</h3>
                    <p>
                        To interact with the contract, switch your wallet to Signet Mode:<br>
                        ‚úÖ Unisat Wallet Extension: Click the network icon <img src="signet.png" alt="Signet Settings" class="inline-icon"> in the top-right corner ‚Üí Select "Bitcoin Testnet, Signet" from the dropdown menu.
                    </p>
                </div>
                
                <div class="info-card">
                    <h2>üí∞ Fee Distribution</h2>
                    <div class="fee-distribution">
                        <div class="fee-item">
                            <div class="fee-percentage">30%</div>
                            <div class="fee-label">First Unlocker</div>
                        </div>
                        <div class="fee-item">
                            <div class="fee-percentage">20%</div>
                            <div class="fee-label">Second Unlocker</div>
                        </div>
                        <div class="fee-item">
                            <div class="fee-percentage">10%</div>
                            <div class="fee-label">Third Unlocker</div>
                        </div>
                        <div class="fee-item">
                            <div class="fee-percentage">40%</div>
                            <div class="fee-label">Contract Support</div>
                        </div>
                    </div>
                    <p class="fee-note">Storage Fee: 0.0001 Signet BTC per message</p>
                </div>
            </div>
            
            <!-- Right Column -->
            <div class="right-column">
                <!-- Block Height Status -->
                <div class="status-card">
                    <h2>‚è±Ô∏è Time Capsule Status</h2>
                    <div class="block-info">
                        <div class="block-stat">
                            <span class="block-label">Current Block:</span>
                            <span id="currentBlockHeight" class="block-value">Loading...</span>
                        </div>
                        <div class="block-stat">
                            <span class="block-label">Unlock Block:</span>
                            <span id="unlockBlockHeight" class="block-value">263527</span>
                        </div>
                        <div class="block-progress">
                            <div id="progressBar" class="progress-bar"></div>
                        </div>
                    </div>
                    <div id="blockStatus" class="status-indicator pending">
                        <div class="countdown-container">
                            <div class="countdown-item">
                                <span id="countdownDays" class="countdown-value">--</span>
                                <span class="countdown-label">Days</span>
                            </div>
                            <div class="countdown-item">
                                <span id="countdownHours" class="countdown-value">--</span>
                                <span class="countdown-label">Hours</span>
                            </div>
                            <div class="countdown-item">
                                <span id="countdownMinutes" class="countdown-value">--</span>
                                <span class="countdown-label">Minutes</span>
                            </div>
                            <div class="countdown-item">
                                <span id="countdownSeconds" class="countdown-value">--</span>
                                <span class="countdown-label">Seconds</span>
                            </div>
                        </div>
                        <p>Time Capsule messages will be unlockable in approximately <span id="blocksRemaining">...</span> blocks</p>
                    </div>
                </div>
                
                <!-- Message Storage Section (hidden until wallet connected) -->
                <div id="messageSection" class="action-card">
                    <h2>‚úâ Store Your Message</h2>
                    <textarea id="message" placeholder="Write your message here..."></textarea>
                    <div class="char-counter"><span id="charCount">0</span>/150 characters (<span id="byteCount">0</span>/80 bytes)</div>
                    <button onclick="encryptMessage()" class="primary-button">Encrypt & Generate Transaction</button>
                    
                    <div id="encryptionResult" style="display: none;">
                        <h3>üîí Encrypted Message</h3>
                        <p id="encryptedMessageOutput" class="code-block"></p>
                        
                        <h3>üìú Transaction Data</h3>
                        <div id="output" class="transaction-details"></div>
                        
                        <button id="signTransaction" class="primary-button">Sign & Submit</button>
                    </div>
                </div>
                
                <!-- Message Retrieval Section -->
                <div class="action-card">
                    <h2>üîç Retrieve Messages</h2>
                    <div class="tab-container">
                        <button class="tab-button active" onclick="switchTab('storedTab')">Stored Messages</button>
                        <button class="tab-button" onclick="switchTab('retrieveTab')">Lookup by ID</button>
                    </div>
                    
                    <div id="storedTab" class="tab-content active">
                        <div id="storedMessagesList" class="message-list">
                            <p>Loading stored messages...</p>
                        </div>
                    </div>
                    
                    <div id="retrieveTab" class="tab-content">
                        <p>Enter the transaction ID of a message to check its status:</p>
                        <div class="search-container">
                            <input type="text" id="txIdInput" placeholder="Transaction ID...">
                            <button onclick="checkMessage()">Check</button>
                        </div>
                        <div id="messageStatus"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <footer>
        <p>Bitcoin Time Capsule Contract | <a href="https://github.com/internetmoneylabs/TimeCapsuleContract" target="_blank">GitHub</a></p>
        <div class="donation-section">
            <p>Support this project:</p>
            <div class="donation-address" id="donationAddress">bc1qyetzzylgkyq6rcqx4uu9jyrhzs0ume44t9rfrw
                <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
                <span class="copy-confirmation">Copied!</span>
            </div>
        </div>
        <p class="visitor-counter">Visitors: <span id="visitorCount">1</span></p>
        <p class="disclaimer">This is an experimental project on Bitcoin Signet. No real BTC is used.</p>
    </footer>

    <script src="script.js"></script>
</body>
</html>
    <!-- Modal Popup Template -->
    <div id="modalOverlay" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="modalTitle" class="modal-title">Message</h3>
                <button id="modalClose" class="modal-close">&times;</button>
            </div>
            <div id="modalBody" class="modal-body">
                <!-- Content will be inserted here -->
            </div>
            <div class="modal-footer">
                <button id="modalOk" class="modal-btn">OK</button>
            </div>
        </div>
    </div>
    <!-- Wallet Selection Modal -->
    <div id="walletSelectionModal" class="modal-overlay">
        <div class="modal-container wallet-modal">
            <div class="modal-header">
                <h3 class="modal-title">Select your Bitcoin wallet</h3>
                <button id="walletModalClose" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="wallet-options">
                    <button class="wallet-option" data-wallet="unisat">
                        <img src="unisat-logo.png" alt="Unisat" width="50" height="50" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'50\' height=\'50\' viewBox=\'0 0 50 50\'%3E%3Crect width=\'50\' height=\'50\' fill=\'%23333\'/%3E%3Ctext x=\'25\' y=\'30\' font-family=\'Arial\' font-size=\'12\' text-anchor=\'middle\' fill=\'%23fff\'%3EUnisat%3C/text%3E%3C/svg%3E'">
                        <span>Unisat</span>
                    </button>
                    <button class="wallet-option" data-wallet="xverse">
                        <img src="xverse-logo.png" alt="Xverse" width="50" height="50" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'50\' height=\'50\' viewBox=\'0 0 50 50\'%3E%3Crect width=\'50\' height=\'50\' fill=\'%23333\'/%3E%3Ctext x=\'25\' y=\'30\' font-family=\'Arial\' font-size=\'12\' text-anchor=\'middle\' fill=\'%23fff\'%3EXverse%3C/text%3E%3C/svg%3E'">
                        <span>Xverse</span>
                    </button>
                    <button class="wallet-option" data-wallet="okx">
                        <img src="okx-logo.png" alt="OKX" width="50" height="50" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'50\' height=\'50\' viewBox=\'0 0 50 50\'%3E%3Crect width=\'50\' height=\'50\' fill=\'%23333\'/%3E%3Ctext x=\'25\' y=\'30\' font-family=\'Arial\' font-size=\'12\' text-anchor=\'middle\' fill=\'%23fff\'%3EOKX%3C/text%3E%3C/svg%3E'">
                        <span>OKX</span>
                    </button>
                    <button class="wallet-option" data-wallet="leather">
                        <img src="leather-logo.png" alt="Leather" width="50" height="50" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'50\' height=\'50\' viewBox=\'0 0 50 50\'%3E%3Crect width=\'50\' height=\'50\' fill=\'%23333\'/%3E%3Ctext x=\'25\' y=\'30\' font-family=\'Arial\' font-size=\'12\' text-anchor=\'middle\' fill=\'%23fff\'%3ELeather%3C/text%3E%3C/svg%3E'">
                        <span>Leather</span>
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <p class="wallet-disclaimer">By connecting your wallet, you agree to <a href="#" id="tcppLink">Terms of Service and Privacy Policy</a></p>
            </div>
        </div>
    </div>